## 多线程的实现

线程在许多系统里已经实现,但是各个系统实现的方式并不完全相同.
总结将目前一个有两种形式的线程:

 - KST 内核支持线程
 - ULT 用户级线程

##### KST

内核支持线程的创建 调度 销毁由内核管控,在内核空间实现.其优点:

 - 在`多处理器系统`中,内核能够同时调度同一进程中的多个线程并行执行 
 - 如果线程被阻塞，内核可以调用同一进程中的其它线程继续占用处理器 
 - 内核线程具有很小的数据结构与堆栈,线程切换开销小
 
缺点

 - 与用户态线程切换而言,切换模式开销较大.(用户态->内核态->用户态|用户态->用户态) 

概念注释:

多处理器系统中包含多个处理器，就是说单台电脑上有多个处理器；
多核处理器系统指处理器是一个多核心的处理器，也就是说电脑的CPU是多核的。

线程可以并行
进程只能并发

对于多核心的架构，由于共用一套MMU和cache，所以地址空间是一个,同一时刻只能运行一个进程，此时进程不能并行只能并发。
**同一个进程下的多线程可以并行执行，因为多线程共享同一套进程空间资源**.对于多cpu架构可以支持进程并行。(这个说法我比较认同)

多核CPU是指多个核心集成在同一个芯片上.每个核心都有自己的寄存器,ALU运算单元. 但是多个核心需要共享一级，二级缓存,主存等资源.
核心之间通过芯片总线来交互数据.多个核心可以进行**并行计算(并行执行指令)**.

操作系统负责管理分配CPU核心.其实程序到了CPU这里已经不能称为程序了,程序已经转化为了指令流水.在多个核心中,操作系统可能在闲时只使用一个,而其它核心闲置.


##### ULT

线程仅仅存在用户空间,线程创建 调度 撤销 通信 都无需系统调用参与.因而线程切换特别快.

优点：

 - 切换快
 - 用户线程的实现与操作平台无关
 - 调度算法可以为进程专用.进程A使用调度算法i,进程B使用调度算法j.
 
缺点

 - **阻塞了线程会导致该进程,该进程内的其它线程均阻塞** 注意与内核线程的阻塞机制对比
 - 纯用户线程实现系统中,多线程不能利用多核的优势.
 
#### 面试题

**内核线程与用户线程的区别**

 - 用户线程由进程自行管理,线程管理开销较内核线程小.
 - 用户线程能够使用的表空间以及堆栈空间比内核线程大,允许用户线程自定义调度管理算法.
 - 用户线程阻塞会引起进程阻塞,内核线程阻塞不一定会引起进程阻塞