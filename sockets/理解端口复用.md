## 理解端口复用

唯一的确定一个`connect`需要4个元素

 1. 服务器的IP
 2. 服务器的Port
 3. 客户端的IP
 4. 客户端的Port

其中服务器的IP和Port可以保持不变，而客户端的IP和Port则各自不同.比如Nginx监听80端口.而来自各个IP的客户端连接都可以与Nginx的80端口进行通信.


	[sujianhui@dev529 sockets]$>netstat -ant | grep 80
	tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN     
	tcp        0      0 127.0.0.1:80            127.0.0.1:56192         ESTABLISHED
	tcp        0      0 127.0.0.1:80            127.0.0.1:56160         TIME_WAIT  
	tcp        0      0 127.0.0.1:80            127.0.0.1:56164         TIME_WAIT  
	tcp        0      0 127.0.0.1:80            127.0.0.1:56188         ESTABLISHED
	tcp        0      0 127.0.0.1:56188         127.0.0.1:80            ESTABLISHED
	tcp        0      0 127.0.0.1:56192         127.0.0.1:80            ESTABLISHED

服务端口与客户端端口是一对多的关系.


一个socket是可以建立多个连接的，为了阐释这个概念，你应该先明白一个TCP连接的标记为一个四元组
	
	(source_ip, source_port, destination_ip, destination_port)
	(源IP，源端口，目的IP，目的端口)

只要四个元素的组合中有一个元素不一样，那就是一个不同的连接，比如：
你的`Server IP`地址是11.1.2.3, 在8080端口监听,那么当一个来自`22.4.5.6`，端口为`5555`的连接到达后，那么建立的这条连接的四元组为
	
	(11.1.2.3, 8080, 22.4.5.6, 5555)

此时，假设上面的那个客户`22.4.5.6`发来第二条连接请求，端口为`6666`，那么，新连接的四元组为

	(11.1.2.3, 8080, 22.4.5.6, 6666)

此时,Server的8080端口同时handler两条连接；如果，此时上面的那个客户`22.4.5.6`发来的第三条连接请求的端口如果为5555或6666，则不会建立新的连接.

### 四元组升级到五元组

`可以在同一个端口号和IP地址上绑定一个TCP套接字和一个UDP套接字,原因在于端口号虽然一样，但由于协议不一样，所以端口是完全独立的`.

`tcp/udp`一般采用五元组来定位一个连接:

	(src_ip, src_port, dest_ip, dest_port, protocol_type)

我们常说的socket中的三元组的概念是指用一个三元组来标示一个完整socket连接中的一端. `(ip,port,protocol)`

### 参考资料

https://blog.csdn.net/dlf1769/article/details/78786775
